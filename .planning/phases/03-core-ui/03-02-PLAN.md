---
phase: 03-core-ui
plan: 02
type: execute
---

<objective>
Build the file list view with sorting and visual grouping by scope (global vs project).

Purpose: The middle column of the NavigationSplitView shows the filtered file list, grouped by scope, with sorting options and file selection that drives the detail column.
Output: FileListView with scope-based sections, sorting by name/date/size, file row with metadata, and selection binding to appState.selectedFile.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/03-core-ui/03-01-SUMMARY.md

# Key source files:
@ClaudeShelf/App/AppState.swift
@ClaudeShelf/App/ContentView.swift
@ClaudeShelf/Views/Sidebar/SidebarView.swift
@ClaudeShelf/Models/FileEntry.swift
@ClaudeShelf/Models/Scope.swift
@ClaudeShelf/Models/Category.swift

**Tech stack available:** SwiftUI, Swift 6, Observation framework
**Established patterns:** @Observable + @MainActor, @Environment injection, NavigationSplitView
**Constraining decisions:**
- [01-02]: @Observable + @Environment pattern
- [03-01]: SidebarView drives selectedCategory, ContentView has NavigationSplitView
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FileListView with scope grouping and sorting</name>
  <files>ClaudeShelf/Views/Sidebar/FileListView.swift, ClaudeShelf/Views/Sidebar/FileRowView.swift, ClaudeShelf.xcodeproj/project.pbxproj</files>
  <action>
Create two view files:

**FileListView.swift** — the content column view:
1. @Environment(AppState.self) for state
2. Add a @State sortOrder property with enum SortOrder: String, CaseIterable { case name, date, size } (define inside the file or as a nested type)
3. Compute sorted+grouped files from appState.filteredFiles:
   - Group by scope (global first, then project)
   - Sort within each group by the selected sort order (name: alphabetical on displayName, date: most recent first, size: largest first)
4. Display as List(selection: $appState.selectedFile) with:
   - Section("Global") for scope == .global files
   - Section("Project") for scope == .project files (show project name in header if available)
   - Each row is a FileRowView
   - Selection tag: use file.id with proper typing (selectedFile is FileEntry?, so .tag the row with Optional<FileEntry>)
5. Toolbar with a Picker for sort order (segmented or menu style)
6. Show "No files" placeholder when filteredFiles is empty
7. Include #Preview

**FileRowView.swift** — a single file row:
1. Takes a FileEntry as parameter (not environment)
2. Shows:
   - Category SF Symbol icon (small, secondary color)
   - VStack with:
     - displayName as primary text (.font(.body))
     - name as secondary text if different from displayName (.font(.caption), .foregroundStyle(.secondary))
   - Spacer
   - Trailing: file size formatted (use ByteCountFormatter with .file countStyle) and relative date (.font(.caption2), .foregroundStyle(.tertiary))
3. If file.isReadOnly, show a small lock icon (SF Symbol "lock.fill") in the trailing area
4. Include #Preview with sample FileEntry

Add both files to project.pbxproj (use E2 prefix for Phase 3 plan 2 IDs). Add to Sidebar group or create a FileList group under Views — keep it simple, Sidebar group works since the file list is the content column.
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>FileListView.swift and FileRowView.swift exist, build without errors, files are grouped by scope and sortable</done>
</task>

<task type="auto">
  <name>Task 2: Wire FileListView into ContentView content column</name>
  <files>ClaudeShelf/App/ContentView.swift</files>
  <action>
Replace the placeholder content column in ContentView with FileListView():

1. Content column: Replace the scanning check / file count placeholder with:
   - If appState.isScanning: ProgressView("Scanning...")
   - Else: FileListView()
2. Keep the detail column as-is (will be updated in 03-03)
3. Update #Preview
4. Ensure the NavigationSplitView selection flow works:
   - Sidebar selects category → filters files via AppState
   - Content column shows filtered files via FileListView
   - File selection in FileListView sets appState.selectedFile
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>ContentView uses FileListView in content column, build succeeds, three-column navigation flow works (category → file list → detail)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds without errors
- [ ] FileListView shows files grouped by scope (Global / Project sections)
- [ ] Sort picker works (name, date, size)
- [ ] FileRowView shows icon, name, size, date, lock icon for read-only
- [ ] File selection in list updates appState.selectedFile
- [ ] Empty state shows "No files" placeholder
- [ ] #Preview blocks exist for all new views
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- File list displays grouped by scope with sorting
- Full navigation flow: category sidebar → file list → detail selection
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-ui/03-02-SUMMARY.md`
</output>
