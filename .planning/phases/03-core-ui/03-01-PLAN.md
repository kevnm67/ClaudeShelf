---
phase: 03-core-ui
plan: 01
type: execute
---

<objective>
Build the category sidebar and wire it into the three-column NavigationSplitView layout.

Purpose: Replace the placeholder sidebar and content columns with a real category list that drives filtering, giving the app its primary navigation structure.
Output: SidebarView with SF Symbols icons, file counts, total sizes per category, and selection binding that filters the file list via AppState.selectedCategory.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph:
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/02-file-scanner/02-03-SUMMARY.md

# Key source files:
@ClaudeShelf/App/AppState.swift
@ClaudeShelf/App/ContentView.swift
@ClaudeShelf/App/ClaudeShelfApp.swift
@ClaudeShelf/Models/Category.swift
@ClaudeShelf/Models/FileEntry.swift
@ClaudeShelf/Models/Scope.swift

**Tech stack available:** SwiftUI, Swift 6, Observation framework, CryptoKit, os.Logger, XCTest
**Established patterns:** @Observable + @MainActor for state, @Environment for injection, NavigationSplitView three-column layout, .task modifier for async launch work
**Constraining decisions:**
- [01-02]: @Observable over ObservableObject, @Environment over @EnvironmentObject
- [02-03]: AppState.performScan() wired with .task on WindowGroup content
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SidebarView with category list</name>
  <files>ClaudeShelf/Views/Sidebar/SidebarView.swift, ClaudeShelf.xcodeproj/project.pbxproj</files>
  <action>
Create SidebarView.swift in Views/Sidebar/. The view:

1. Takes @Environment(AppState.self) for state access
2. Shows a List with:
   - An "All Files" row at top showing total file count (appState.files.count), with SF Symbol "tray.full" — selected when appState.selectedCategory == nil
   - A section for each Category (use Category.allCases) showing:
     - Category SF Symbol icon (category.sfSymbol)
     - Category display name (category.displayName)
     - File count badge on trailing side (from appState.categoryCounts[category] ?? 0)
   - Only show categories that have files (count > 0), plus always show "All Files"
3. Selection binding: use @Bindable var appState to create $appState.selectedCategory binding with List(selection:). When a category row is tapped, set selectedCategory. When "All Files" tapped, set to nil.
4. Use .navigationTitle("ClaudeShelf") on the list
5. Include #Preview with mock AppState

For the @Bindable pattern with @Observable: since AppState is injected via @Environment, use `@Bindable var appState` local binding inside the body to create two-way bindings.

Note: Category? selection needs a wrapper. Use an enum `SidebarSelection` with cases `.all` and `.category(Category)` or use `Category?` directly with nil meaning "all". Direct `Category?` is simpler — use that. The List selection type should be `Category?`. For the "All Files" row, use a tag of `Category?.none` via `.tag(Category?.none)`.

Add the new file to the Xcode project.pbxproj:
- Create PBXFileReference with a unique ID (use E1 prefix for Phase 3 plan 1)
- Add to the Sidebar PBXGroup (check project.pbxproj for Sidebar group ID or create one under Views)
- Add PBXBuildFile to the app sources build phase
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>SidebarView.swift exists, builds without errors, shows categories with icons and counts</done>
</task>

<task type="auto">
  <name>Task 2: Wire SidebarView into ContentView</name>
  <files>ClaudeShelf/App/ContentView.swift</files>
  <action>
Replace the placeholder sidebar column in ContentView's NavigationSplitView with SidebarView().

Update ContentView:
1. Sidebar column: Replace `Text("Categories")` with `SidebarView()`
2. Content column (file list): Keep the scanning/count placeholder for now — will be replaced in 03-02. But update to show "No files found" when not scanning and files are empty, "Select a category" as secondary text, and the file count when files exist.
3. Detail column: Keep the current error/placeholder — will be replaced in 03-03.
4. Keep the existing .frame(minWidth: 800, minHeight: 500)
5. Add .navigationSplitViewColumnWidth constraints if needed for good defaults:
   - sidebar: min 200, ideal 220
   - content: min 250, ideal 300
6. Update #Preview

Do NOT move the .task modifier — it stays on ClaudeShelfApp.swift.
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>ContentView uses SidebarView in sidebar column, builds without errors, NavigationSplitView has proper column structure</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds without errors
- [ ] SidebarView.swift exists in Views/Sidebar/
- [ ] SidebarView shows "All Files" + categories with SF Symbols and counts
- [ ] Category selection updates appState.selectedCategory
- [ ] ContentView uses SidebarView in sidebar column
- [ ] #Preview blocks exist for both views
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- SidebarView renders category list with icons and file counts
- Category selection filters via AppState binding
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-ui/03-01-SUMMARY.md`
</output>
