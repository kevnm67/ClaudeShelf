---
phase: 03-core-ui
plan: 03
type: execute
---

<objective>
Add search, keyboard shortcuts, and a basic file content display in the detail column.

Purpose: Complete the three-column UI with search filtering, standard macOS keyboard shortcuts, and a read-only file content viewer that shows the selected file's text.
Output: Working search field (Cmd+F), keyboard shortcuts for common actions, and FileDetailView showing file content with metadata header.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/03-core-ui/03-01-SUMMARY.md
@.planning/phases/03-core-ui/03-02-SUMMARY.md

# Key source files:
@ClaudeShelf/App/AppState.swift
@ClaudeShelf/App/ContentView.swift
@ClaudeShelf/App/ClaudeShelfApp.swift
@ClaudeShelf/Views/Sidebar/SidebarView.swift
@ClaudeShelf/Views/Sidebar/FileListView.swift
@ClaudeShelf/Models/FileEntry.swift

**Tech stack available:** SwiftUI, Swift 6, Observation framework
**Established patterns:** @Observable + @MainActor, @Environment injection, NavigationSplitView, .task for async work
**Constraining decisions:**
- [01-02]: @Observable + @Environment
- [03-01]: SidebarView with category selection
- [03-02]: FileListView with file selection → appState.selectedFile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FileDetailView with content display</name>
  <files>ClaudeShelf/Views/Editor/FileDetailView.swift, ClaudeShelf.xcodeproj/project.pbxproj</files>
  <action>
Create FileDetailView.swift in Views/Editor/. This is a read-only content viewer (the full editor comes in Phase 4):

1. Takes a FileEntry as parameter
2. Layout:
   - Header bar showing:
     - File name (.font(.headline))
     - Category badge (SF Symbol + category name, small pill/tag style)
     - Scope badge ("Global" or project name)
     - Lock icon if isReadOnly
     - File size (formatted with ByteCountFormatter)
     - Last modified date (formatted with .relative date style)
   - Divider
   - ScrollView with file content:
     - Load content from file.path using String(contentsOfFile:encoding:) in a .task modifier
     - Use @State var fileContent: String? and @State var loadError: String?
     - Display content in a Text view with .font(.system(.body, design: .monospaced)) for code-like appearance
     - Show loading indicator while content is nil
     - Show error message if file can't be read (user-friendly, not raw path)
3. The content loading should be async-safe: use .task(id: file.id) so it reloads when selected file changes
4. Include #Preview with sample FileEntry

Add to project.pbxproj with E3 prefix IDs. Add to Editor group under Views.

Note: Do NOT use try! — use do/catch and set loadError on failure. Keep error messages user-friendly per CLAUDE.md rules.
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>FileDetailView.swift exists, builds, displays file metadata header and monospaced content</done>
</task>

<task type="auto">
  <name>Task 2: Add search field and keyboard shortcuts, wire detail view</name>
  <files>ClaudeShelf/App/ContentView.swift, ClaudeShelf/App/AppState.swift</files>
  <action>
Update ContentView to complete the three-column UI:

1. **Detail column:** Replace the error/placeholder with:
   - If appState.selectedFile is set: FileDetailView(file: selectedFile)
   - Else if errorMessage: show error in red
   - Else: "Select a file to view" placeholder with secondary style

2. **Search field:** Add .searchable(text: $appState.searchText, prompt: "Search files...") on the NavigationSplitView or the content column. This automatically binds to appState.searchText which already powers filteredFiles. On macOS, .searchable provides Cmd+F focus automatically.

3. **Keyboard shortcuts:** Add to ContentView or ClaudeShelfApp:
   - Cmd+R: Rescan — call appState.performScan(). Use .keyboardShortcut("r", modifiers: .command) on a hidden Button in a toolbar or use SwiftUI Commands.
   - For Cmd+R to work app-wide, the cleanest approach is adding a Commands { } block in ClaudeShelfApp.swift with a CommandMenu or using .commands modifier on WindowGroup. Add a "File" CommandGroup with:
     - "Rescan" (Cmd+R) that calls performScan

   Note: Cmd+F is handled automatically by .searchable. Cmd+S will come in Phase 4 (Editor). Cmd+Delete will come in Phase 5 (File Operations).

4. **Toolbar:** Add a toolbar to ContentView with:
   - A rescan button (arrow.clockwise) that calls performScan
   - Show scanning state: disable button and show progress indicator in toolbar while scanning

5. Update #Preview blocks

For the Commands integration in ClaudeShelfApp.swift:
- Add .commands { } modifier to WindowGroup scene
- Use CommandGroup(after: .newItem) or CommandMenu("Actions") with rescan button
- The command needs @Environment(AppState.self) — but Commands don't support @Environment. Instead, use @FocusedValue or pass appState directly. Simplest: add the keyboard shortcut to ContentView's toolbar Button instead of using Commands.
  </action>
  <verify>xcodebuild build -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS' 2>&1 | tail -5</verify>
  <done>Search field filters files in real-time, Cmd+R triggers rescan, detail column shows selected file content, toolbar has rescan button</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds without errors
- [ ] FileDetailView shows file metadata header and monospaced content
- [ ] .searchable field filters files via appState.searchText
- [ ] Cmd+R or toolbar button triggers rescan
- [ ] Detail column updates when a file is selected
- [ ] Error states handled (file not readable, no selection)
- [ ] All tests still pass: `xcodebuild test -project ClaudeShelf.xcodeproj -scheme ClaudeShelf -destination 'platform=macOS'`
- [ ] #Preview blocks exist for new views
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- Complete three-column UI functional: categories → file list → file content
- Search filters across name, path, displayName, project
- Keyboard shortcut for rescan works
- Phase 3 Core UI complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-ui/03-03-SUMMARY.md`
</output>
